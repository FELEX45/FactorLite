## Глава 1. Идея и анализ предметной области

### 1.1 Обзор жанра *survivor-like* и UX‑паттернов

Жанр *survivor-like* (часто описываемый как «авто‑атака + выживание под нарастающей нагрузкой») сформировался как формат коротких, повторяемых забегов, в которых основная сложность строится не на точности ручной стрельбы, а на тактическом позиционировании, выборе улучшений и управлении риском. Игрок управляет перемещением персонажа, а атака по врагам выполняется автоматически (либо с минимальными действиями со стороны игрока). При этом игра постоянно увеличивает давление на игрока — через рост частоты спавна, повышение характеристик противников и появление новых типов угроз.

Ключевые признаки жанра:

- **Авто‑атака и авто‑таргетинг**. Боевая эффективность определяется тем, как игрок выбирает траекторию движения, удерживает дистанцию и «собирает» ситуацию в бою (позиционирование), а не скоростью реакций на нажатия. Такой подход снижает порог входа и хорошо подходит для сенсорного управления.
- **Нарастающая сложность (difficulty ramp)**. Забег устроен как временная кривая напряжения: сначала игроку дают время освоиться, затем постепенно увеличивают количество угроз и плотность столкновений. Это поддерживает динамику и создаёт понятную цель — «продержаться дольше».
- **Выбор улучшений «1 из 3»**. Регулярные остановки или полупаузы на выбор (level‑up/награда) формируют серию микро‑решений: игрок постоянно сравнивает варианты и строит билд. При этом формат «три карточки» оптимален для восприятия на мобильном экране: мало вариантов — меньше когнитивной нагрузки, но достаточно для вариативности.
- **Короткие игровые сессии**. Типичная длительность забега подстраивается под мобильный сценарий использования: игру можно запустить «на несколько минут» и получить завершённый опыт (победа/поражение/прогресс).

UX‑паттерны, характерные для *survivor-like* на мобильных устройствах, во многом вытекают из ограничений платформы (малый экран, управление пальцами, внешние отвлечения):

- **Управление одним пальцем**. На практике чаще всего используется *floating joystick*: точка появления стика задаётся первым касанием, а направление и сила — смещением пальца. Дополняется *deadzone* (зона нечувствительности) и ограничением радиуса, чтобы управление было устойчивым и предсказуемым.
- **Читаемый HUD и крупные интерактивные элементы**. На телефоне критичны размеры шрифта, контраст и отступы: здоровье, уровень, валюта и состояния должны считываться за доли секунды. Отдельно важны крупные элементы паузы и карточек выбора, т.к. они нажимаются пальцем и не должны требовать высокой точности.
- **Минимизация “лишних” действий**. Авто‑атака, автоматический выбор цели (с разумной стабильностью, чтобы цель не «дёргалась») и быстрые экраны выбора позволяют удерживать темп без перегрузки интерфейса.
- **Частая обратная связь**. Поскольку игрок не “целится” вручную, ощущение контроля поддерживается через визуальные и числовые сигналы: попадания, прирост характеристик, понятные эффекты улучшений, а также демонстрацию изменений «было → стало» при выборе.
- **Безопасная пауза и предсказуемые оверлеи**. Мобильный сценарий предполагает прерывания, поэтому пауза должна быть доступна мгновенно и явно останавливать критические подсистемы. Экраны выбора (level‑up, сундуки, святыни) также обычно блокируют основной геймплей и переводят игрока в режим принятия решения.

Таким образом, *survivor-like* естественно подходит мобильной платформе: он снижает требования к точному вводу, строит вовлекающий цикл через короткие сессии и микро‑решения, а также позволяет поддерживать ощущение прогресса даже при небольшом времени игры. Для проекта FactorLite это означает, что на этапе требований и проектирования ключевыми становятся: устойчивое сенсорное управление, корректное масштабирование UI под разные экраны, прозрачные карточки улучшений и управляемая кривая сложности забега.

### 1.2 Концепция FactorLite и дизайн‑цели

Проект FactorLite развивает идеи жанра *survivor-like* в формате мобильного MVP, где приоритетом являются быстрый старт, читаемость интерфейса и возможность итеративно расширять контент. В основе игры лежит повторяемый забег (run), который начинается с выбора параметров (персонажа и сложности), затем переходит в активный бой и завершается состоянием победы или поражения.

#### Игровая петля (core loop)

Концептуальная петля FactorLite описывается следующим образом:

- **Движение**: игрок управляет только перемещением персонажа и выбором позиции относительно врагов и объектов на карте.
- **Авто‑атака**: атаки выполняются автоматически, а результат зависит от позиционирования, дистанции и собранного билда.
- **Награды**: за активность в бою игрок получает опыт (XP) и валюту забега (gold), а также доступ к событиям/объектам усиления.
- **Усиление**: по мере прогрессии игрок регулярно выбирает улучшения (формат «1 из 3») и усиливает персонажа несколькими независимыми способами.
- **Риск/награда**: усиление сопровождается ростом сложности; часть усилений специально встроена как “сделка” (получить бонус ценой повышения риска).
- **Финал**: забег завершается **победой** (достижение целевого условия/финального события) либо **поражением** (исчерпание ресурса выживания).

#### Два независимых канала усиления

В FactorLite предусмотрены два канала прогрессии, которые дополняют друг друга и повышают реиграбельность за счёт разнообразия билдов:

- **Level Up (оружие/пассивки)**: при наборе достаточного количества XP игрок переходит в состояние выбора улучшения и получает 3 карточки («1 из 3»). Улучшения направлены на развитие текущего билда (усиление уже взятых опций) и на добавление новых элементов (если есть свободные слоты).
- **Сундуки/предметы**: второй канал построен через экономику забега (gold), сундуки на карте и предметы с триггерами (например, эффекты на попадание/убийство/получение урона или по таймеру). Важно, что этот канал не дублирует Level Up, а добавляет отдельный слой “пассивных” или ситуативных эффектов, влияющих на тактику и темп забега.

#### Ограничение слотов как дизайн‑решение (фокус и баланс)

Слоты в билде ограничены (на текущем этапе: **2+2**, то есть 2 оружия и 2 пассивных слота). Такое ограничение выбрано осознанно по следующим причинам:

- **Снижение когнитивной нагрузки**: на мобильном устройстве игроку проще держать в голове меньше активных источников урона и эффектов.
- **Прозрачность выбора**: при небольшом количестве слотов легче показать и почувствовать причинно‑следственную связь «взял улучшение → стало сильнее/иначе».
- **Контроль баланса**: ограничение предотвращает “снежный ком” слишком большого количества синергий и упрощает настройку кривых сложности и прогрессии.
- **Рост вариативности забегов**: при ограниченных слотах игрок вынужден выбирать направление билда, а не собирать “всё подряд”.

#### Риск/награда и мета‑выборы внутри забега

Для поддержки интереса на протяжении забега в FactorLite предусмотрены события, которые требуют от игрока решения “стоит ли рисковать”. Примером такого механизма являются святыни: игрок должен выполнить условие (например, удержаться в зоне некоторое время), после чего получает выбор глобального бонуса. Такие бонусы усиливают персонажа, но могут влиять на общую сложность забега, формируя динамику “сильнее сейчас — сложнее дальше”.

#### Дизайн‑цели проекта

На уровне продукта и реализации проект ориентирован на следующие цели:

- **Мобильная читаемость**: крупные интерактивные элементы (карточки выбора, пауза), масштабируемый UI/HUD и достаточный размер шрифта для разных экранов.
- **Короткий, завершённый игровой опыт**: забег спроектирован так, чтобы за несколько минут игрок успевал почувствовать рост силы и получить понятный результат (победа/поражение).
- **Системность и расширяемость**: контент и баланс стремятся быть data-driven (конфиги), чтобы новые персонажи/оружие/предметы и правки чисел добавлялись с минимальными изменениями кода.
- **Стабильность и предсказуемость**: состояния игры (выбор персонажа/сложности, пауза, выбор улучшений, победа/поражение) явно разделены, что упрощает контроль логики и UX.

### 1.3 Требования к продукту

Требования к FactorLite формулируются с учётом целевого сценария использования на мобильном устройстве и рамок MVP. Требования разделены на функциональные, нефункциональные и ограничения, задающие границы первой версии.

#### Функциональные требования

- **Управление перемещением**: реализовать сенсорное управление в формате *floating joystick* с “мёртвой зоной” (deadzone) и ограничением радиуса, преобразующее ввод в вектор скорости персонажа.
- **Авто‑таргетинг**: реализовать выбор ближайшей цели в радиусе действия, обеспечив стабильность цели (например, через гистерезис и периодическое перенацеливание), чтобы избежать “дёрганья” при высокой плотности врагов.
- **Боевая система**: обеспечить автоматическую атаку в зависимости от текущего билда (оружие/модификаторы), обработку попаданий и нанесение урона; учитывать базовые эффекты статусов и периодический урон (DoT) как часть расширяемой боевой модели.
- **Прогрессия XP/LevelUp**: реализовать накопление опыта и рост уровня; при достижении уровня переводить игру в состояние выбора улучшения и предоставлять игроку выбор **«1 из 3»**.
- **Сундуки и экономика забега**: реализовать внутриигровую валюту (gold), появление сундуков на карте и правила их открытия; стоимость сундуков должна быть управляемой и ограниченной (в рамках баланса забега).
- **Предметы‑триггеры**: реализовать предметы, влияющие на игровой процесс через триггеры событий (например, onHit/onKill/onDamageTaken и обновление по таймеру), чтобы обеспечить второй канал усиления помимо Level Up.
- **Святыни и глобальные бонусы**: реализовать событийные объекты (святыни), которые требуют выполнения условия (например, нахождение в зоне) и затем предоставляют выбор глобального бонуса; бонусы должны влиять на параметры забега и поддерживать механику риск/награда.
- **Состояния забега**: реализовать явную модель состояний, разделяющую игровой процесс и интерфейсные оверлеи (например, выбор сложности, выбор персонажа, пауза, основной режим, выбор улучшения, выбор бонуса, победа, поражение).
- **Победа/поражение**: реализовать условия завершения забега и отображение результата (game over / victory) с возможностью перезапуска.

#### Нефункциональные требования

- **Производительность**: целевая частота обновления — **60 FPS** на типичном мобильном устройстве; система должна контролировать нагрузку (лимиты на количество объектов, частоту обновлений, отсутствие “лишних” аллокаций).
- **Стабильность**: отсутствие критических падений в основных сценариях (старт → забег → выборы → победа/поражение → перезапуск).
- **Читаемость UI/HUD**: информация HUD (HP/уровень/валюта/состояние) должна считываться быстро; интерактивные элементы (карточки, пауза) должны иметь достаточный размер для нажатия пальцем.
- **Масштабирование под разные экраны**: интерфейс должен корректно адаптироваться к разным разрешениям и соотношениям сторон (как минимум телефонный портретный формат).
- **Повторяемая загрузка ассетов и шрифтов**: ресурсы (текстуры, данные баланса, шрифты) должны загружаться предсказуемо и одинаково на разных платформах.
- **Воспроизводимая сборка**: сборка проекта должна выполняться стандартными средствами (Gradle), обеспечивая воспроизводимый результат для Desktop‑раннера и Android‑версии.

#### Ограничения (рамки MVP)

- **Минимальный набор контента**: ограниченное число персонажей/врагов/оружия/предметов для демонстрации систем, с возможностью расширения.
- **Приоритет системности над объёмом**: архитектура и data-driven подход важнее количества контента в первой версии.
- **Фокус на расширяемости**: новые элементы (оружие, предметы, параметры баланса) должны добавляться без масштабных изменений существующего кода и UI.

### 1.4 Планирование работы и артефакты жизненного цикла

Разработка FactorLite ведётся итеративно, с фиксацией состояния проекта через Git‑коммиты и сопровождением в виде документации и вспомогательных инструментов. Такой подход позволяет контролировать прогресс, быстро возвращаться к рабочим версиям и снижать стоимость изменений баланса/контента.

#### Дорожная карта этапов разработки

- **Этап 1 — базовый MVP‑каркас**: запуск Desktop‑версии как “быстрого контура” разработки, базовый игровой цикл, первичный рендер и управление.
- **Этап 2 — систематизация кода**: декомпозиция на отдельные подсистемы (бой, враги, лут, таргетинг, прогрессия), что повышает поддерживаемость и позволяет параллельно развивать механики.
- **Этап 3 — наполнение забега смыслом**: добавление событий и целей (святыни, глобальные бонусы, финал забега/босс), ввод ограничений экономики (лимиты сундуков) и настройка темпа сложности.
- **Этап 4 — подготовка к Android**: интеграция Android‑модуля, воспроизводимая сборка APK и проверка запуска на устройстве.
- **Этап 5 — UX и читаемость**: доведение HUD/оверлеев и масштабирование интерфейса под мобильные экраны, улучшение экранов выбора (персонаж/сложность/апгрейды).
- **Этап 6 — data-driven баланс и контент**: вынесение параметров в конфиги, поддержка быстрых правок и инструментов подготовки контента (редактор/шаблоны).
- **Этап 7 — публикация в Google Play (Play Market)**: подготовка релизной сборки (AAB), подпись ключом, загрузка в треки тестирования (internal/closed), заполнение карточки приложения (иконка/скриншоты/описание) и выпуск в production.

#### Вехи проекта через коммиты (контрольные точки)

В рамках дипломного проекта вехи фиксируются коммитами в репозитории. Примеры ключевых контрольных точек:

- `967c498` — стартовый каркас проекта и MVP‑забег с Desktop‑раннером.
- `99d652e` — рефакторинг: разбиение логики на подсистемы (loot/combat/enemy/targeting).
- `fdcfd49` — развитие “структуры забега”: святыни/бонусы, лимиты сундуков, усложнение спавна, цель забега (5 минут + босс).
- `fa40dfa` — добавление сборки Android (получение versioned APK).
- `f6547b9` — организация ассетов и детерминированная загрузка шрифтов.
- `1f6d1c6` — крупный шаг по UX/контенту: баланс/данные, выбор сложности/персонажа, пауза и HUD, масштабирование интерфейса.

#### Документация и артефакты

В репозитории поддерживаются следующие артефакты жизненного цикла:

- **Инструкции по запуску и сборке**: `README.md` (быстрый запуск Desktop для отладки).
- **Документация по контенту**: `docs/README.md`, а также материалы-черновики (`docs/мекасронк.txt`, `docs/персы.txt`) как источник требований к контенту.
- **Инструменты**: `docs/content_editor.html` — локальный редактор контента (прототип), поддерживающий подготовку данных и экспорт конфигов.
- **Шаблоны/seed‑данные**: `docs/factorlite_content_seed.yaml` — черновик для согласования статов, апгрейдов и весов (основа для дальнейшей формализации).
- **Конфиги баланса**: `assets/data/balance.json` — data-driven параметры, позволяющие итеративно настраивать игру без правки логики.
- **Текст диплома**: `docs/diploma/01-introduction.md`, `docs/diploma/02-chapter-1.md` — разделы, развиваемые параллельно с кодом.
